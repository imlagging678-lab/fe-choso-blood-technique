-- [AYARLAR GÜNCELLENDİ]
local tiltAngle = 15 -- Pozitif değer karakteri arkaya yatırır
local downOffset = -0.5 -- Arkaya yatarken dengede durması için hafif aşağı çekme

RunService.Heartbeat:Connect(function()
    if isEquipped and player.Character then
        local HRP = player.Character:FindFirstChild("HumanoidRootPart")
        if not HRP or not stayPos then return end

        -- 1. Hedef Takibi (Highlight)
        local target = mouse.Target
        if target and target.Parent and target.Parent:FindFirstChild("Humanoid") then
            highlight.Adornee = target.Parent
            highlight.Parent = target.Parent
        else
            highlight.Parent = nil
        end

        -- 2. FLING & POSITION LOCK
        if isFiring and highlight.Adornee and highlight.Adornee:FindFirstChild("HumanoidRootPart") then
            local enemyHRP = highlight.Adornee.HumanoidRootPart
            
            -- Walkfling Gücü
            HRP.Velocity = Vector3.new(999999, 999999, 999999)
            HRP.CFrame = enemyHRP.CFrame * CFrame.Angles(math.random(-180, 180), math.random(-180, 180), math.random(-180, 180))
            
            RunService.RenderStepped:Wait()
            -- Geri dönüşte eğik pozisyona (stayPos) dön
            HRP.CFrame = stayPos
            HRP.Velocity = Vector3.new(0, 0, 0)
        else
            -- [DURURKEN ARKAYA EĞİK SABİTLEME]
            HRP.CFrame = stayPos
            HRP.Velocity = Vector3.new(0, 0, 0)
            HRP.RotVelocity = Vector3.new(0, 0, 0)
        end
    end
end)

tool.Equipped:Connect(function()
    local char = player.Character
    local hrp = char:WaitForChild("HumanoidRootPart")
    local hum = char:WaitForChild("Humanoid")

    -- [FE BACK-TILT]
    -- Karakteri arkaya eğip biraz aşağı indiriyoruz ki gerçekçi dursun
    stayPos = hrp.CFrame * CFrame.new(0, downOffset, 0) * CFrame.Angles(math.rad(tiltAngle), 0, 0)
    isEquipped = true
    
    animTrack = hum:WaitForChild("Animator"):LoadAnimation(animation)
    animTrack.Priority = Enum.AnimationPriority.Action4
    animTrack:Play()
    
    hum.PlatformStand = true -- Hareket etmesini engeller, eğimi korur
end)
